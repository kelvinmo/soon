name: Update launch date

on:
  schedule:
    - cron: "0 3 1 1 *"
  workflow_dispatch:

jobs:
  update-launch-date:
    name: Update launch date
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Calculate new launch date
        id: launch-date
        run: echo LAUNCH_DATE=$(date -d '+3 years' -I) >> $GITHUB_OUTPUT

      - name: Replace launch date in _config.yml
        run: 'sed -i "s/launch_date:\\s\+[-0-9]\+$/launch_date: ${{ steps.launch-date.outputs.LAUNCH_DATE }}/" _config.yml'

      - name: Create pull request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Update launch date
          title: Update launch date
          body: |
            Update launch date
            
            - Auto-generated by [create-pull-request][1]
            
            [1]: https://github.com/peter-evans/create-pull-request
          branch: update-launch-date/update
          branch-suffix: timestamp
          delete-branch: true
